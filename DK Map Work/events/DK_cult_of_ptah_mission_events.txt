# Written by Rick Visser (PTAH.1 - PTAH.1000)

namespace = PTAH

### MISSIONS ###
# Tombola
character_event = {
    id = PTAH.1
    hide_window = yes

    is_triggered_only = yes
    is_in_society = yes
    only_capable = yes

    trigger = {
        society_member_of = dk_cult_of_ptah
        has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
    }

    immediate = {
        random_society_member = {
            limit = {
                is_society_grandmaster = yes
                same_society_as = ROOT
            }
            save_event_target_as = high_priest_of_ptah
        }

        # MISSIONS:
        # - Serving in the temple TODO
        # - Craft a sacred object TODO
        # - Teach child about Ptah's creation of the world TODO
        # - Find an apis bull TODO
        # - Organise the Sekhmet festival TODO

        random_list = {
            20 = {
                event_target:high_priest_of_ptah = {
                    character_event = { id = PTAH.2 } # Serve in the temple
                }
            }
        }
    }
}

####################################
### MISSION: Serve in the temple ###
####################################

# Flavourful events:
# - Piece of unpainted wall needs to be fixed. TODO
# - Two lustful characters find eachother in the temple. TODO
# - Feeding the gods. TODO
# - The Mummy. TODO
# - Finding reference to Akhetaten TODO

# Ping event
character_event = {
    id = PTAH.10
    hide_window = yes

    is_triggered_only = yes

    immediate = {
        FROM = { society_quest_event = { id = PTAH.11 days = 3 random = 7 } }
    }
}

# Acceptance event
society_quest_event = {
    id = PTAH.11
    desc = EVTDESC_PTAH_11
    # TODO: Do we need a quest target for the temple?

    is_triggered_only = yes
    
    option = {
        name = ACCEPT
        set_quest = quest_cult_of_ptah_serve_temple
    }
    
	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

# Character starts travelling towards the temple
character_event = {
    id = PTAH.12
    desc = EVTDESC_PTAH_12
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    immediate = {
        add_trait = travelling
    }

    option = {
        name = EVTOPTA_PTAH_12
        hidden_tooltip = {
            character_event = { id = PTAH.13 days = 3}
        }
    }
}

# Character arrives at the temple.
character_event = {
    id = PTAH.13
    desc = EVTDESC_PTAH_13
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = {
        name = EVTOPTA_PTAH_13
        set_character_flag = kemetic_temple_arrived

        # Character receives a shave.
        hidden_tooltip = {
            random_society_member = {
                limit = {
                    society_member_of = dk_cult_of_ptah
                    society_rank >= 3
                }
                character_event = { id = PTAH.7 }
            }
        }
    }
}

# Ping event for the temple priest.
character_event = {
    id = PTAH.14
    hide_window = yes

    immediate = {
        FROM = {
            character_event = { id = PTAH.8 }
        }
    }
}

# Character receives a shave from the priests.
character_event = {
    id = PTAH.15
    desc = EVTDESC_PTAH_15
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = {
        name = EVTOPTA_PTAH_15
        set_character_flag = kemetic_temple_shaved # TODO: Make the character go bald.
    }
}

# Character ends his service at the temple.
character_event = {
    id = PTAH.20
    desc = EVTDESC_PTAH_20
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    immediate = {
        remove_trait = travelling
        clr_quest = quest_cult_of_ptah_serve_temple
        clr_character_flag = is_serving_kemetic_temple
        clr_character_flag = kemetic_temple_shaved
        clr_character_flag = kemetic_temple_arrived
        clr_character_flag = kemetic_temple_painting_dilemma
    }

    option = {
        name = EVTOPTA_PTAH_20
    }
}

# EVENT SERIES: Deteriorated wall needs to be repainted?
# Events PTAH.30 - PTAH.59

# Character discovers a piece of wall where paint has been damaged.
character_event = {
    id = PTAH.30
    desc = EVTDESC_PTAH_30
    picture = GFX_event_picture_placeholder

    trigger = {
        NOT = { trait = blinded } # Blind characters do not see any paintings.
        has_character_flag = kemetic_temple_arrived
        NOT = { has_character_flag = kemetic_temple_painting_dilemma }
    }

    mean_time_to_happen = { # TODO: Customize this
        months = 1
    }

    immediate = {
        set_character_flag = kemetic_temple_painting_dilemma
    }

    option = { # The character fixes it himself to impress the priesthood.
        name = EVTOPTA_PTAH_30
        trigger = {
            scaled_wealth = { value = 0.1 max = 10 min = 1}
        }
        ai_chance = {
            factor = 6 # We want to boost the possibility for hilarity.

            modifier = { # Doesn't believe in himself.
                factor = 0.5
                trait = depressed 
            }
            modifier = { # Doesn't want to spend the money.
                factor = 0.75
                trait = greedy
            }
            modifier = { # Want to spend money to better the world.
                factor = 1.1
                trait = charitable
            }
            modifier = { # He is content with the state of the picture.
                factor = 0.6
                trait = content
            }
            modifier = { # Ambitious characters are more willing to go on endeavours.
                factor = 2
                trait = ambitious
            }
        }

        # Deduct some money.
        scaled_wealth = { value = -0.1 max = -10 min = -1 }

        # Character starts painting.
        hidden_tooltip = {
            character_event = { id = PTAH.31 }
        }
    }

    option = { # The character reports it to the priest.
        name = EVTOPTB_PTAH_30

        ai_chance = {
            factor = 4

            modifier = { # Is afraid of talking
                factor = 0.5
                trait = shy
            }
            modifier = { # Loves talking
                factor = 1.5
                OR = {
                    trait = gregarious
                    trait = socializer
                }
            }
        }

        # TODO: Events
    }

    option = { # The character doesn't do anything.
        name = EVTOPTC_PTAH_30

        ai_chance = {
            factor = 4

            modifier = { # Lazy character love not doing anything.
                factor = 2
                trait = slothful
            }
            modifier = { # Doesn't like to get involved with this religion stuff.
                factor = 1.25
                trait = cynical
            }
            modifier = { # Would do anything for the gods.
                factor = 0.25
                trait = zealous
            }
            modifier = { # Architects would not want to see the building in this state.
                factor = 0.5
                trait = architect
            }
            modifier = { # Proud (nationalist) nubians don't want the painting to be restored.
                factor = 1.5
                AND = {
                    culture = nubian
                    trait = proud
                }
            }
        }
    }
}

# Character starts to restore the painting himself. 
character_event = {
    id = PTAH.31
    desc = EVTDESC_PTAH_31
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = { # Character keeps on mixing colors to get the right effect.
        name = EVTOPTA_PTAH_31
        trigger = {
            scaled_wealth = { value = 0.1 max = 10 min = 1}
        }
        ai_chance = {
            factor = 4

            modifier = { # Charitable characters are more willing to spend money on good causes.
                factor = 1.5
                trait = charitable
            }
            modifier = { # Patient characters will want to keep at it.
                factor = 1.25
                trait = patient
            }
        }

        # Deduct some money.
        scaled_wealth = { value = -0.1 max = -10 min = -1 }

        # Character mixes the colors correctly and finishes the painting.
        hidden_tooltip = { 
            character_event = { id = PTAH.32 }
        }
    }

    option = { # Character uses the incorrectly mixed colors.
        name = EVTOPTB_PTAH_31
        ai_chance = {
            factor = 4

            modifier = { # Stressed characters are more likely to rush work.
                factor = 1.5
                trait = stressed
            }
            modifier = { # Greedy characters dislike spending more money, but also do not want to lose their investment.
                factor = 1.25
                trait = greedy
            }
        }

        set_character_flag = kemetic_painting_incorrect_colors

        # TODO: Add event.
    }

    option = { # Character gives up completely.
        name = EVTOPTC_PTAH_31
        ai_chance = {
            factor = 3

            modifier = { # Depressed characters are likely to give up.
                factor = 2
                trait = depressed
            }
            modifier = { # Lazy characters are likely to give up.
                factor = 2
                trait = slothful
            }
            modifier = { # Ambitious characters want to complete the painting.
                factor = 0.25
                trait = ambitious
            }
            modifier = { # Zealous characters do not want to displease the gods.
                factor = 0.5
                trait = zealous
            }
            modifier = { # Architects would not want to see the building in this state.
                factor = 0.5
                trait = architect
            }
        }
    }
}

# Character mixed the colors correctly and finishes the painting.
character_event = {
    id = PTAH.32
    desc = EVTDESC_PTAH_32
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = {
        name = EVTOPTA_PTAH_32

        set_character_flag = kemetic_painting_correct_colors

        hidden_tooltip = {
            character_event = { id = PTAH.33 }
        }
    }
}

# Notification event that the character finished the painting.
character_event = {
    id = PTAH.33
    desc = EVTDESC_PTAH_33
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    # Add a tiny bit of society currency.
    immediate = {
        add_society_currency_trivial_effect = yes
    }

    option = { # Character spent more time and money to restore the painting.
        name = EVTOPTA_PTAH_33
        trigger = {
            has_character_flag = kemetic_painting_correct_colors
        }

        # Possibly add proud.
        if = {
            limit = {
                NOT = { trait = proud }
            }
            random = {
                chance = 15
                add_trait = proud
            }
        }

        random_list = {
            40 = {
                painting_success_outcome_score = yes
                
                set_character_flag = kemetic_painting_good_quality

                random_society_member = {
                    limit = {
                        society_member_of = dk_cult_of_ptah
                        NOT = { trait = blinded } # Blind characters do not see any paintings.
                        has_character_flag = kemetic_temple_arrived
                    }
                    character_event = { id = PTAH.34 days = 4 random = 5 }
                }
            }
            35 = {
                painting_neutral_outcome_score = yes

                # Nothing happens.
            }
            35 = {
                painting_bad_outcome_score = yes

                set_character_flag = kemetic_painting_bad_quality

                # TODO: Add events for the bad outcome.
            }
        }

        clr_character_flag = kemetic_painting_correct_colors
    }

    option = { # Quick and dirty fix.
        name = EVTOPTB_PTAH_33
        trigger = {
            has_character_flag = kemetic_painting_incorrect_colors
        }

        random_list = {
            30 = {
                painting_success_outcome_score = yes

                set_character_flag = kemetic_painting_good_quality

                random_society_member = {
                    limit = {
                        society_member_of = dk_cult_of_ptah
                        NOT = { trait = blinded } # Blind characters do not see any paintings.
                        has_character_flag = kemetic_temple_arrived
                    }
                    character_event = { id = PTAH.34 days = 4 random = 5 }
                }
            }
            20 = {
                painting_neutral_outcome_score = yes

                # Nothing happens.
            }
            50 = {
                painting_bad_outcome_score = yes

                set_character_flag = kemetic_painting_bad_quality
                # TODO: Add events for the bad outcome.
            }
        }

        clr_character_flag = kemetic_painting_incorrect_colors
    }
}

# Another character sees the vastly improved painting and tells the priests.
character_event = {
    id = PTAH.34
    desc = EVTDESC_PTAH_34
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = { # I should tell the priests.
        name = EVTOPTA_PTAH_34
        ai_chance = {
            factor = 3.5

            modifier = { # Is afraid of talking
                factor = 0.5
                trait = shy
            }
            modifier = { # Loves talking
                factor = 1.5
                OR = {
                    trait = gregarious
                    trait = socializer
                }
            }
            modifier = { # Loves a good mystery.
                factor = 1.25
                OR = {
                    trait = cynical
                    trait = deceitful
                }
            }
        }

        hidden_tooltip = {
            random_society_member = {
                limit = {
                    society_member_of = dk_cult_of_ptah
                    society_rank >= 3
                }
                character_event = { id = PTAH.35 }
            }
        }
    }

    option = { # Marvel at the painting.
        name = EVTOPTB_PTAH_34
        ai_chance = {
            factor = 2

            modifier = { # Encourage depressed or stressed characters to rest.
                factor = 2
                OR = {
                    trait = depressed
                    trait = stressed
                }
            }
            modifier = { # Proud (nationalist) nubians won't marvel at the painting that depicts their weaknesses.
                factor = 0.5
                AND = {
                    culture = nubian
                    trait = proud
                }
            }
            modifier = { # Lazy characters are likely to give up.
                factor = 2
                trait = slothful
            }
            modifier = { # Architects would be impressed!
                factor = 1.25
                trait = architect
            }
        }

        # Character reflects on the glory of Egypt.
        piety = 10

        # Paintings might be destressing.
        if = {
            limit = {
                trait = stressed
            }
            random = {
                chance = 10
                remove_trait = stressed
            }
        }

        # Depressed characters might be cured from depression from the painting.
        if = {
            limit = {
                trait = depressed
            }
            random = {
                chance = 10
                remove_trait = depressed
            }
        }
    }
}

# Ping event for the priests holding a meeting about the restoration of the painting.
character_event = {
    id = PTAH.35
    hide_window = yes # The priests might get spammed with these events. Let's not show them.

    is_triggered_only = yes

    immediate = {
        FROMFROM = { character_event = { id = PTAH.36 }}
    }
}

# The priest goes to the painter to ask if he fixed the painting.
character_event = {
    id = PTAH.36
    desc = EVTDESC_PTAH_36
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = { # Tell the priest that you restored the painting.
        name = EVTOPTA_PTAH_36

        set_character_flag = kemetic_painter_truth
    }
    option = { # Lie
        name = EVTOPTB_PTAH_36

        if = {
            limit { 
                NOT = { trait = deceitful }
            }

            add_trait = deceitful
        }

        set_character_flag = kemetic_painter_lie
    }
}

# Ping event for the priest to respond to the answer of the painter.
character_event = {
    id = PTAH.37
    hide_window = yes

    is_triggered_only = yes

    immediate = {
        if = {
            limit = {
                FROM = { has_character_flag = kemetic_painter_lie }
            }

            random_list = {
                60 = { # Priest believes the lie if he is honest or bad at intrigue.
                    modifier = { # Low intrigue causes the character to believe the lie.
                        factor = 1.25
                        intrigue < 8
                    }
                    modifier = { # Low intrigue causes the character to believe the lie.
                        factor = 1.5
                        intrigue < 6
                    }
                    modifier = { # Low intrigue causes the character to believe the lie.
                        factor = 2
                        intrigue < 4
                    }
                    modifier = { # Honest characters are more likely to believe a lie.
                        factor = 1.5
                        trait = honest
                    }
                    modifier = { # If the character has high intrigue, he will always see through the lie.
                        factor = 0
                        intrigue = 15
                    }

                    FROM = { character_event = { id = PTAH.38 }}
                }
                30 = { # Priest has a good response from piety.
                    painting_priest_pious_score = yes

                    FROM = { character_event = { id = PTAH.39 }}
                }
                30 = { # Priest has a good response from pride.
                    painting_priest_proud_score = yes

                    FROM = { character_event = { id = PTAH.40 }}
                }
                30 = { # Priest has a bad response as he believes the character should have asked permission first.
                    painting_priest_authoritarian_score = yes

                    FROM = { character_event = { id = PTAH.41 }}
                }
                30 = { # Priest has a bad response as he thinks the painting is shit.
                    painting_priest_bad_quality_score = yes

                    FROM = { character_event = { id = PTAH.42 }}
                }
            }
        } else = {
            random_list = {
                30 = { # Priest has a good response from piety.
                    painting_priest_pious_score = yes

                    FROM = { character_event = { id = PTAH.39 }}
                }
                30 = { # Priest has a good response from pride.
                    painting_priest_proud_score = yes

                    FROM = { character_event = { id = PTAH.40 }}
                }
                30 = { # Priest has a bad response as he believes the character should have asked permission first.
                    painting_priest_authoritarian_score = yes

                    FROM = { character_event = { id = PTAH.41 }}
                }
                30 = { # Priest has a bad response as he thinks the painting is shit.
                    painting_priest_bad_quality_score = yes

                    FROM = { character_event = { id = PTAH.42 }}
                }
            }
        }
    }
}

# Priest believes the lie if he has bad intrigue skills
character_event = {
    id = PTAH.38
    desc = EVTDESC_PTAH_38
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = {
        name = EVTOPTA_PTAH_38

        # TODO: Add cons / benefits.
    }
}

# Priest good response - pious
character_event = {
    id = PTAH.39
    desc = EVTDESC_PTAH_39
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = {
        name = EVTOPTA_PTAH_39

        # TODO: Add cons / benefits.
    }
}

# Priest good response - proud
character_event = {
    id = PTAH.40
    desc = EVTDESC_PTAH_40
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = {
        name = EVTOPTA_PTAH_40

        # TODO: Add cons / benefits.
    }
}

# Priest bad response - should have asked permission
character_event = {
    id = PTAH.41
    desc = EVTDESC_PTAH_41
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = {
        name = EVTOPTA_PTAH_41

        # TODO: Add cons / benefits.
    }
}

# Priest bad response - quality is bad
character_event = {
    id = PTAH.42
    desc = EVTDESC_PTAH_42
    picture = GFX_event_picture_placeholder

    is_triggered_only = yes

    option = {
        name = EVTOPTA_PTAH_42

        # TODO: Add cons / benefits.
    }
}